--- a/yatexlib.el
+++ b/yatexlib.el
@@ -27,11 +27,17 @@
-(defvar YaTeX-display-color-p
-  (or (and (fboundp 'display-color-p) (display-color-p))
-      (and (fboundp 'device-class)
-	   (eq 'color (device-class (selected-device))))
-      window-system)  ; falls down lazy check..
-  "Current display's capability of expressing colors.")
+(defvar YaTeX-display-color-p
+  (cond
+   ((fboundp 'display-color-p) (display-color-p))
+   ((fboundp 'device-class)
+    (condition-case nil
+        (eq 'color (device-class))
+      (error nil)))
+   (window-system t)
+   (t nil))
+  "Current display's capability of expressing colors.")

